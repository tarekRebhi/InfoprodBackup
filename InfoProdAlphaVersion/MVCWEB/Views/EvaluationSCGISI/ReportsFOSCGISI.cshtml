@model MVCWEB.Models.EvaluationViewModel
@{

    Layout = "~/Views/Shared/_Layout_Qualite.cshtml";
}

@section test{
    <script src="~/Scripts/zingchart.min.js"></script>
    <div class="row">

        <div class="col-1">
            <h6 class="col-xs-2 control-label">Dates Début / Fin </h6>
            <div class="col-xs-3 date">
                <div class="form-group">
                    <div class="input-group">
                        <span class="input-group-addon"><i class="icon-calendar22"></i></span>
                        <input type="text" class="form-control daterange-basic" name="datetimes" id="datetimes" value="01/01/2020 - 01/31/2020">
                    </div>
                </div>
            </div>
        </div>

        <div class="col-1">
            <h6 class="col-xs-2 control-label">Choisissez Collaborateur</h6>
            <div class="col-xs-3">
                @Html.DropDownList("AgentDropdownList", Model.employees, "---Select Collaborateur---", htmlAttributes: new { @class = "bootstrap-select", @id = "agent", @name = "test", style = "data-width: 360px;", selected = "selected" })
                @Html.ValidationMessageFor(model => model.employees, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="col-xs-1">
            <button id="Save" type="submit" class="btn bg-teal-400" data-title="Chercher" value="Chercher">Recherche <i class="icon-stats-bars3 position-right"></i></button>
        </div>
    </div>


    <div class="row">
        <div class="col-md-12" id="myChart3"></div>
    </div>

    <div class="panel border-left-lg border-left-info" style="margin-left: 0.2cm;" id="Details" hidden>
        <div class="panel-body">
            <h6 class="no-margin-top"><a href="task_manager_detailed.html"># Moyenne Items</a></h6>
            <div class="row">
                <div class="col-md-4">

                    <div class="form-group">
                        <label class="col-md-7" style="font-weight: bold;">Accueil:</label>
                        <div class="col-md-3" id="accueil">
                        </div>
                    </div>
                    <br />
                    <div class="form-group">
                        <label class="col-md-7" style="font-weight:bold;">Analyse de la demande:</label>
                        <div class="col-md-3" id="analyseDemande">
                        </div>
                    </div>
                    <br />
                    <div class="form-group">
                        <label class="col-md-7" style="font-weight:bold;">Maitrise des outils de travail (loggia/hcub):</label>
                        <div class="col-md-3" id="maitriseOutils">
                        </div>
                    </div>
                    <br />
                    <div class="form-group">
                        <label class="col-md-7" style="font-weight:bold;">Connaissance du produit:</label>
                        <div class="col-md-3" id="connaissanceProduit">
                        </div>
                    </div>
                    <br />
                    <div class="form-group">
                        <label class="col-md-7" style="font-weight:bold;">Respect des process de travail:</label>
                        <div class="col-md-3" id="respectProcess">
                        </div>
                    </div>
                    <br />
                </div>

                <div class="col-md-4">
                    <div class="form-group">
                        <label class="col-md-7" style="font-weight:bold;">Pertinence de la réponse:</label>
                        <div class="col-md-3" id="pertinenceReponse">
                        </div>
                    </div>

                    <br />
                    <div class="form-group">
                        <label class="col-md-7" style="font-weight:bold;">FCR:</label>
                        <div class="col-md-3" id="FCR">
                        </div>
                    </div>

                    <br />
                    <div class="form-group">
                        <label class="col-md-7" style="font-weight:bold;">Autonomie:</label>
                        <div class="col-md-3" id="autonomie">
                        </div>
                    </div>
                    <br />
                    <div class="form-group">
                        <label class="col-md-7" style="font-weight:bold;">Approche Commerciale:</label>
                        <div class="col-md-3" id="approcheCommerciale">
                        </div>
                    </div>
                    <br />
                    <div class="form-group">
                        <label class="col-md-7" style="font-weight:bold;">Identification du client CRM:</label>
                        <div class="col-md-3" id="identificationClient">
                        </div>
                    </div>
                    

                </div>

                <div class="col-md-4">                    
                    <div class="form-group">
                        <label class="col-md-7" style="font-weight:bold;">Qualification des demandes sur CRM:</label>
                        <div class="col-md-3" id="qualificationDemande">
                        </div>
                    </div>
                    <br />
                    <div class="form-group">
                        <label class="col-md-7" style="font-weight:bold;">Discours:</label>
                        <div class="col-md-3" id="discours">
                        </div>
                    </div>
                    <br />
             
                    <div class="form-group">
                        <label class="col-md-7" style="font-weight:bold;">Prise de congé:</label>
                        <div class="col-md-3" id="priseConge">
                        </div>
                    </div>
                    <br />
                </div>
            </div>
        </div>
    </div>

    <div class="row" id="Graphs" hidden>
        <div class="col-md-8">
            <div class="panel panel-flat">
                <div class="panel-heading">
                    <h6 class="panel-title"><i class="icon-stats-bars3"></i> <span style="font-size: 16px;">Répartition Moyenne des Items SC GISI (Front Office)</span></h6><hr />
                </div>
                <div class="container-fluid">
                    <div>
                        <div id="myChart"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="panel panel-flat">
                <div class="panel-heading">
                    <h6 class="panel-title"><i class="icon-pie-chart"></i> <span style="font-size: 16px;">Moyenne des Notes </span></h6><hr />
                </div>
                <div class="container-fluid">
                    <div>
                        <div id="myChartPie"></div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        var debut = '01/01/2020';
        var fin = '31/01/2020';
        $(function () {
            $('#datetimes').daterangepicker({

                opens: 'right',
                format: 'DD/MM/YYYY',
                locale: {

                    "daysOfWeek": [
              "Dim",
              "Lun",
              "Mar",
              "Mer",
              "Jeu",
              "Ven",
              "Sam"
                    ],
                    "monthNames": [
                        "Jan",
                        "Fev",
                        "Mar",
                        "Avr",
                        "Mai",
                        "Ju",
                        "Jui",
                        "Aou",
                        "Sep",
                        "Oct",
                        "Nov",
                        "December"
                    ],
                },
                lan: 'fr',


            },
             function (start, end, label) {
                 debut = start.format('DD/MM/YYYY');
                 fin = end.format('DD/MM/YYYY');
             }
            );
        });
    </script>
    <script type="text/javascript">

        $(document).ready(function () {
            $(document).on("click", "#Save", function () {
                $.ajax({
                    url: '/EvaluationSCGISI/GetReportsFOSCGISI',
                    type: 'GET',
                    datatype: 'json',
                    data: {
                        username: $("#agent").val(),
                        dateDebut: debut,
                        dateFin: fin
                    },
                    async: true,
                    success: function (data) {
                        //Variables
                        var note = data.note;
                        var NbreEvaluations = data.nbreEvaluations;

                        var accueil = data.accueil + "%";
                        var analyseDemande = data.analyseDemande + "%";
                        var maitriseOutils = data.maitriseOutils + "%";
                   
                        if (data.connaissanceProduit >= 0) {
                            var connaissanceProduit = data.connaissanceProduit + "%";
                        } else { var connaissanceProduit = "NE" }

                        if (data.approcheCommerciale >= 0) {
                            var approcheCommerciale = data.approcheCommerciale + "%";
                        } else { var approcheCommerciale = "NE" }
                        var respectProcess = data.respectProcess + "%";
                        var pertinenceReponse = data.pertinenceReponse + "%";
                        if (data.FCR >= 0) {
                            var FCR = data.FCR + "%";
                        } else { var FCR = "NE" }
                        var autonomie = data.autonomie + "%";
                        var identificationClient = data.identificationClient + "%";
                        var qualificationDemande = data.qualificationDemande + "%";
                        var discours = data.discours + "%";
                        var priseConge = data.priseConge + "%";
                        //Affichage
                        $("#Details").show();
                        $("#Graphs").show();

                        $("#accueil").html(accueil);
                        $("#analyseDemande").html(analyseDemande);
                        $("#maitriseOutils").html(maitriseOutils);
                        $("#connaissanceProduit").html(connaissanceProduit);
                        $("#respectProcess").html(respectProcess);
                        $("#pertinenceReponse").html(pertinenceReponse);
                        $("#FCR").html(FCR);
                        $("#autonomie").html(autonomie);
                        $("#approcheCommerciale").html(approcheCommerciale);
                        $("#identificationClient").html(identificationClient);
                        $("#qualificationDemande").html(qualificationDemande);
                        $("#discours").html(discours);
                        $("#priseConge").html(priseConge);

                        var namesList = ["Accueil", "Analyse de demande", "Maitrise des outils de travail", "Connaissance du produit", "Respect des process", "Pertinence de la réponse",
       "FCR", "Autonomie", "Approche Commerciale", "Identification du client CRM", "Qualification des demandes", "Discours", "Prise de congé"];

                        var values = [ data.accueil,data.analyseDemande, data.maitriseOutils,data.connaissanceProduit,
       data.respectProcess, data.pertinenceReponse,data.FCR, data.autonomie, data.approcheCommerciale,
       data.identificationClient,data.qualificationDemande,data.discours, data.priseConge]
                        var valuesList = [];
                        $.each(values, function (i, t) {
                            if (t >= 0) {
                                valuesList.push(t);
                            }
                            else {
                                valuesList.push(null);
                            }
                        })
                        let chartConfig = {
                            backgroundColor: '#ecf2f6',
                            graphset: [
                              {
                                  type: 'bar',
                                  backgroundColor: '#fff',
                                  borderWidth: '1px',
                                  borderColor: '#dae5ec',
                                  width: '100%',
                                  height: '100%',
                                  x: '0%',
                                  y: '0%',

                                  plot: {
                                      tooltip: {
                                          padding: '5px 10px',
                                          backgroundColor: '#707e94',
                                          borderRadius: '6px',
                                          fontColor: '#fff',
                                          fontFamily: 'Arial',
                                          fontSize: '11px',
                                          shadow: false
                                      },
                                      animation: {
                                          delay: 300,
                                          effect: 'ANIMATION_SLIDE_BOTTOM'
                                      },
                                      barWidth: '33px',
                                      hoverState: {
                                          visible: false
                                      }
                                  },
                                  plotarea: {
                                      margin: '45px 20px 120px 45px'
                                  },
                                  scaleX: {
                                      values: namesList,
                                      guide: {
                                          visible: false
                                      },
                                      item: {
                                          angle: -50,
                                          paddingTop: '2px',
                                          fontColor: '#000',
                                          fontFamily: 'Arial',
                                          fontSize: '11px'
                                      },
                                      itemsOverlap: true,
                                      lineColor: '#d2dae2',
                                      maxItems: 9999,
                                      offsetY: '1px',
                                      tick: {
                                          lineColor: '#d2dae2',
                                          visible: false
                                      }
                                  },
                                  scaleY: {
                                      values: '0:100:50',
                                      guide: {
                                          rules: [
                                                      {
                                                          lineWidth: '0px',
                                                          rule: '%i == 0'
                                                      },
                                                      {
                                                          alpha: 0.4,
                                                          lineColor: '#d2dae2',
                                                          lineStyle: 'solid',
                                                          lineWidth: '1px',
                                                          rule: '%i > 0'
                                                      }
                                          ]
                                      },
                                      item: {
                                          paddingRight: '5px',
                                          fontColor: '#8391a5',
                                          fontFamily: 'Arial',
                                          fontSize: '10px'
                                      },
                                      lineColor: 'none',
                                      maxItems: 4,
                                      maxTicks: 4,
                                      tick: {
                                          visible: false
                                      }
                                  },
                                  series: [
                                    {
                                        values: valuesList,
                                        backgroundColor: '#f3950d',
                                        valueBox: [{
                                            placement: "top-out",
                                            color: "#000",
                                            text: "%v%",
                                            fontSize: 14
                                        }]
                                    }
                                  ]
                              }
                            ]
                        }

                        zingchart.render({
                            id: 'myChart',
                            data: chartConfig,
                            height: '500',
                            width: '100%'
                        });
                        var myConfig = {
                            "background-color": "#FFF",
                            "graphset": [

                                {
                                    "type": "pie",
                                    "width": "105%",
                                    "x": "-20%",
                                    "background-color": "#FFF",
                                    "title": {
                                        "background-color": "none",
                                        "font-weight": "normal",
                                        "font-family": "Arial",
                                        "font-color": "#ffffff",
                                        "height": "30px"
                                    },

                                    "plotarea": {
                                        "margin": "20 280 25 30"
                                    },

                                    "plot": {
                                        "animation": {
                                            "delay": 0,
                                            "effect": 2,
                                            "speed": 700,
                                            "method": 6,
                                            "sequence": 1
                                        },
                                        refAngle: 270,

                                    },
                                    "series": [
                                        {
                                            "text": "Moyenne Notes",
                                            "values": [data.note],
                                            "background-color": "#35D884",
                                            "border-color": "#454754",
                                            "border-width": "1px",
                                            "shadow": 0,
                                            "tooltip": {
                                                "background-color": "#35D884",
                                                "font-color": "#000",
                                                "border-radius": "6px",
                                                "shadow": false,
                                                "padding": "5px 10px"
                                            },
                                            valueBox: [{
                                                placement: "in",
                                                color: "#000",
                                                text: "%t: %v %",
                                                fontSize: 14
                                            }]
                                        },

                                              {
                                                  "text": "",
                                                  "values": [
                                                100 - data.note
                                                  ],
                                                  "background-color": "#E8E8E8",
                                                  "border-color": "#454754",
                                                  "border-width": "1px",
                                                  "shadow": 0,
                                                  "tooltip": {
                                                      "background-color": "#E8E8E8",
                                                      "font-color": "#000",
                                                      "border-radius": "6px",
                                                      "shadow": false,
                                                      "padding": "5px 10px"
                                                  },
                                                  valueBox: [{
                                                      placement: "in",
                                                      color: "#E8E8E8",
                                                      text: "%t: %v %",
                                                      fontSize: 0
                                                  }]
                                              }

                                    ]
                                },


                            ]
                        }
                        zingchart.render({
                            id: 'myChartPie',
                            data: myConfig,
                            height: 500,
                            width: 1050
                        });
                        let chartConfig3 = {

                            graphset: [

                                {
                                    type: 'null',
                                    backgroundColor: '#fbfcf7',
                                    borderColor: '#384653',
                                    borderRadius: '4px',
                                    borderWidth: '1px',
                                    width: '15%',
                                    height: '90%',
                                    x: '33.2%',
                                    y: '3%',
                                    title: {
                                        text: 'Nombre des Evaluations',
                                        backgroundColor: 'none',
                                        fontColor: '#384653',
                                        fontSize: '12px',
                                        height: '70px',
                                        textAlign: 'center'
                                    },
                                    subtitle: {
                                        text: NbreEvaluations,
                                        paddingTop: '35%',
                                        bold: true,
                                        fontColor: '#dd655f',
                                        fontSize: '24px',
                                        height: '40px',
                                        textAlign: 'center'
                                    }
                                },
                              {
                                  type: 'null',
                                  backgroundColor: '#fbfcf7',
                                  borderColor: '#384653',
                                  borderRadius: '4px',
                                  borderWidth: '1px',
                                  width: '15%',
                                  height: '90%',
                                  x: '50.8%',
                                  y: '3%',
                                  title: {
                                      text: 'Moyenne des Notes',
                                      backgroundColor: 'none',
                                      fontColor: '#384653',
                                      fontSize: '12px',
                                      height: '70px',
                                      textAlign: 'center'
                                  },
                                  subtitle: {
                                      text: note + '%',
                                      paddingTop: '35%',
                                      bold: true,
                                      fontColor: '#4cc2bb',
                                      fontSize: '24px',
                                      height: '40px',
                                      textAlign: 'center'
                                  }
                              }
                            ]
                        };
                        zingchart.render({
                            id: 'myChart3',
                            data: chartConfig3,
                            height: '120',
                            width: '100%'
                        });

                    },
                    error: function () { },
                });
            })
        })
    </script>

}

@section testProfile{

    <a class="dropdown-toggle" data-toggle="dropdown">
        <img src=@Model.Url alt="">
        <span>@Model.userName</span>
        <i class="caret"></i>
    </a>
    <ul class="dropdown-menu dropdown-menu-right">

        <li><a href="@Url.Action("logout", "Authentification")"><i class="icon-switch2"></i> Logout</a></li>
    </ul>
}
@section sidebarProfile{

    <a href="#" class="media-left"><img src=@Model.Url class="img-circle img-sm" alt=""></a>
    <div class="media-body">
        <span class="media-heading text-semibold">@Model.userName</span>
        <div class="text-size-mini text-muted">
            <i class="icon-user text-size-small"></i> &nbsp;@Model.pseudoNameEmp
        </div>
    </div>
    <div class="media-right media-middle">

    </div>
}
@section pagetitle{
    <h4> <span class="text-semibold">Espace Qualité</span> -  Reportings</h4>
}
@section pagetitlebody{
    <li><a href="#"><i class="icon-home2 position-left"></i> Reportings</a></li>
    <li class="active">Service Client GISI</li>
    <li class="active">Front Office</li>
}
