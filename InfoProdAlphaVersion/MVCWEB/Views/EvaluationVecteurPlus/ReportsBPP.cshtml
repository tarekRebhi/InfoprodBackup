@model MVCWEB.Models.EvaluationViewModel
@{

    Layout = "~/Views/Shared/_Layout_Qualite.cshtml";
}

@section test{
    <script src="~/Scripts/zingchart.min.js"></script>
    <div class="row">

        <div class="col-1">
            <h6 class="col-xs-2 control-label">Dates Début / Fin </h6>
            <div class="col-xs-3 date">
                <div class="form-group">
                    <div class="input-group">
                        <span class="input-group-addon"><i class="icon-calendar22"></i></span>
                        <input type="text" class="form-control daterange-basic" name="datetimes" id="datetimes" value="01/01/2020 - 01/31/2020">
                    </div>
                </div>
            </div>
        </div>

        <div class="col-1">
            <h6 class="col-xs-2 control-label">Choisissez Collaborateur</h6>
            <div class="col-xs-3">
                @Html.DropDownList("AgentDropdownList", Model.employees, "---Select Collaborateur---", htmlAttributes: new { @class = "bootstrap-select", @id = "agent", @name = "test", style = "data-width: 360px;", selected = "selected" })
                @Html.ValidationMessageFor(model => model.employees, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="col-xs-1">
            <button id="Save" type="submit" class="btn bg-teal-400" data-title="Chercher" value="Chercher">Recherche <i class="icon-stats-bars3 position-right"></i></button>
        </div>
    </div>

  
<div class="row">
    <div class="col-md-12" id="myChart3"></div>
</div>

<div class="panel border-left-lg border-left-info" style="margin-left: 0.2cm;" id="Details" hidden>
    <div class="panel-body">
        <h6 class="no-margin-top"><a href="task_manager_detailed.html"># Moyenne Items</a></h6>
        <div class="row">
            <div class="col-md-4">

                <div class="form-group">
                    <label class="col-md-7" style="font-weight: bold;">Présentation et Identification:</label>
                    <div class="col-md-3" id="presentationIdentification">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Présenter l'objet de l'appel:</label>
                    <div class="col-md-3" id="objetAppel">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Validation et confirmation de la Nature :</label>
                    <div class="col-md-3" id="validationNature">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Calendrier:</label>
                    <div class="col-md-3" id="calendrier">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Envergure:</label>
                    <div class="col-md-3" id="envergure">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Complétude des questions par Typologie:</label>
                    <div class="col-md-3" id="complétudeQuestions">
                    </div>
                </div>

            </div>

            <div class="col-md-4">

                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Confirmation des intervenants:</label>
                    <div class="col-md-3" id="confirmationIntervenants">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Enchainement logique des questions:</label>
                    <div class="col-md-3" id="enchainementQuestions">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Traitement des objections:</label>
                    <div class="col-md-3" id="traitementObjections">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Reformulation:</label>
                    <div class="col-md-3" id="reformulation">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Transcription des informations:</label>
                    <div class="col-md-3" id="transcriptionsInformations">
                    </div>
                </div>

                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Ajout des codes appropriés:</label>
                    <div class="col-md-3" id="codesAppropriés">
                    </div>
                </div>

            </div>

            <div class="col-md-4">
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Note Client / Historique:</label>
                    <div class="col-md-3" id="noteClient">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Discours:</label>
                    <div class="col-md-3" id="discours">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Empathie / Attitude:</label>
                    <div class="col-md-3" id="attitude">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Prise de congé:</label>
                    <div class="col-md-3" id="priseConge">
                    </div>
                </div>
                <br />
            </div>
        </div>
    </div>
</div>

<div class="row" id="Graphs" hidden>
    <div class="col-md-8">
        <div class="panel panel-flat">
            <div class="panel-heading">
                <h6 class="panel-title"><i class="icon-stats-bars3"></i> <span style="font-size: 16px;">Répartition Moyenne des Items Vecteur Plus BPP</span></h6><hr />
            </div>
            <div class="container-fluid">
                <div>
                    <div id="myChart"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="panel panel-flat">
            <div class="panel-heading">
                <h6 class="panel-title"><i class="icon-pie-chart"></i> <span style="font-size: 16px;">Moyenne des Notes </span></h6><hr />
            </div>
            <div class="container-fluid">
                <div>
                    <div id="myChartPie"></div>
                </div>
            </div>
        </div>
    </div>

</div>


    <script>
        var debut = '01/01/2020';
        var fin = '31/01/2020';
        $(function () {
            $('#datetimes').daterangepicker({

                opens: 'right',
                format: 'DD/MM/YYYY',
                locale: {

                    "daysOfWeek": [
              "Dim",
              "Lun",
              "Mar",
              "Mer",
              "Jeu",
              "Ven",
              "Sam"
                    ],
                    "monthNames": [
                        "Jan",
                        "Fev",
                        "Mar",
                        "Avr",
                        "Mai",
                        "Ju",
                        "Jui",
                        "Aou",
                        "Sep",
                        "Oct",
                        "Nov",
                        "December"
                    ],
                },
                lan: 'fr',


            },
             function (start, end, label) {
                 debut = start.format('DD/MM/YYYY');
                 fin = end.format('DD/MM/YYYY');
             }
            );
        });
    </script>
    <script type="text/javascript">

        $(document).ready(function () {
            $(document).on("click", "#Save", function () {
                $.ajax({
                    url: '/EvaluationVecteurPlus/GetReportsBPP',
                    type: 'GET',
                    datatype: 'json',
                    data: {
                        username: $("#agent").val(),
                        dateDebut: debut,
                        dateFin: fin
                    },
                    async: true,
                    success: function (data) {
                        //Variables
                        var note = data.note;
                        var NbreEvaluations = data.nbreEvaluations;

                        var presentationIdentification = data.presentationIdentification + "%";
                        var objetAppel = data.objetAppel + "%";

                        if (data.validationNature >= 0) {
                            var validationNature = data.validationNature + "%";
                        } else { var validationNature = "NE" }

                        if (data.calendrier >= 0) {
                            var calendrier = data.calendrier + "%";
                        } else { var calendrier = "NE" }

                        if (data.envergure >= 0) {
                            var envergure = data.envergure + "%";
                        } else { var envergure = "NE" }

                        if (data.complétudeQuestions >= 0) {
                            var complétudeQuestions = data.complétudeQuestions + "%";
                        } else { var complétudeQuestions = "NE" }

                        if (data.confirmationIntervenants >= 0) {
                            var confirmationIntervenants = data.confirmationIntervenants + "%";
                        } else { var confirmationIntervenants = "NE" }

                        if (data.enchainementQuestions >= 0) {
                            var enchainementQuestions = data.enchainementQuestions + "%";
                        } else { var enchainementQuestions = "NE" }

                        if (data.traitementObjections >= 0) {
                            var traitementObjections = data.traitementObjections + "%";
                        } else { var traitementObjections = "NE" }

                        if (data.reformulation >= 0) {
                            var reformulation = data.reformulation + "%";
                        } else { var reformulation = "NE" }

                        if (data.transcriptionsInformations >= 0) {
                            var transcriptionsInformations = data.transcriptionsInformations + "%";
                        } else { var transcriptionsInformations = "NE" }

                        if (data.codesAppropriés >= 0) {
                            var codesAppropriés = data.codesAppropriés + "%";
                        } else { var codesAppropriés = "NE" }

                        if (data.noteClient >= 0) {
                            var noteClient = data.noteClient + "%";
                        } else { var noteClient = "NE" }

                        var discours = data.discours + "%";
                        var attitude = data.attitude + "%";
                        var priseConge = data.priseConge + "%";
                        //Affichage
                        $("#Details").show();
                        $("#Graphs").show();

                        $("#presentationIdentification").html(presentationIdentification);
                        $("#objetAppel").html(objetAppel);
                        $("#validationNature").html(validationNature);
                        $("#calendrier").html(calendrier);
                        $("#envergure").html(envergure);
                        $("#complétudeQuestions").html(complétudeQuestions);
                        $("#confirmationIntervenants").html(confirmationIntervenants);
                        $("#enchainementQuestions").html(enchainementQuestions);
                        $("#traitementObjections").html(traitementObjections);
                        $("#reformulation").html(reformulation);
                        $("#transcriptionsInformations").html(transcriptionsInformations);
                        $("#codesAppropriés").html(codesAppropriés);
                        $("#noteClient").html(noteClient);
                        $("#discours").html(discours);
                        $("#attitude").html(attitude);
                        $("#priseConge").html(priseConge);

                        var namesList = ["Presentation", "Objet de l'appel", "Validation Nature", "Calendrier", "Envergure", "Complétude des Questions", "Confirmation Intervenants",
        "Enchainement des Questions", "Traitement des objections", "Reformulation", "Transcription des informations", "Codes Appropriés","Note Client", "Discours", "Empathie / Attitude", "Prise de congé"];
                        var values = [data.presentationIdentification, data.objetAppel, data.validationNature, data.calendrier, data.envergure,data.complétudeQuestions,
                        data.confirmationIntervenants,data.enchainementQuestions,data.traitementObjections,data.reformulation,data.transcriptionsInformations,data.codesAppropriés,data.noteClient,data.discours,data.attitude,data.priseConge];
     
                        var valuesList = [];
                        $.each(values, function (i, t) {
                            if (t >= 0) {
                                valuesList.push(t);
                            }
                            else {
                                valuesList.push(null);
                            }
                        })
                        let chartConfig = {
                            backgroundColor: '#ecf2f6',
                            graphset: [
                              {
                                  type: 'bar',
                                  backgroundColor: '#fff',
                                  borderWidth: '1px',
                                  borderColor: '#dae5ec',
                                  width: '100%',
                                  height: '100%',
                                  x: '0%',
                                  y: '0%',

                                  plot: {
                                      tooltip: {
                                          padding: '5px 10px',
                                          backgroundColor: '#707e94',
                                          borderRadius: '6px',
                                          fontColor: '#fff',
                                          fontFamily: 'Arial',
                                          fontSize: '11px',
                                          shadow: false
                                      },
                                      animation: {
                                          delay: 300,
                                          effect: 'ANIMATION_SLIDE_BOTTOM'
                                      },
                                      barWidth: '33px',
                                      hoverState: {
                                          visible: false
                                      }
                                  },
                                  plotarea: {
                                      margin: '45px 20px 120px 45px'
                                  },
                                  scaleX: {
                                      values: namesList,
                                      guide: {
                                          visible: false
                                      },
                                      item: {
                                          angle: -50,
                                          paddingTop: '2px',
                                          fontColor: '#000',
                                          fontFamily: 'Arial',
                                          fontSize: '11px'
                                      },
                                      itemsOverlap: true,
                                      lineColor: '#d2dae2',
                                      maxItems: 9999,
                                      offsetY: '1px',
                                      tick: {
                                          lineColor: '#d2dae2',
                                          visible: false
                                      }
                                  },
                                  scaleY: {
                                      values: '0:100:50',
                                      guide: {
                                          rules: [
                                                      {
                                                          lineWidth: '0px',
                                                          rule: '%i == 0'
                                                      },
                                                      {
                                                          alpha: 0.4,
                                                          lineColor: '#d2dae2',
                                                          lineStyle: 'solid',
                                                          lineWidth: '1px',
                                                          rule: '%i > 0'
                                                      }
                                          ]
                                      },
                                      item: {
                                          paddingRight: '5px',
                                          fontColor: '#8391a5',
                                          fontFamily: 'Arial',
                                          fontSize: '10px'
                                      },
                                      lineColor: 'none',
                                      maxItems: 4,
                                      maxTicks: 4,
                                      tick: {
                                          visible: false
                                      }
                                  },
                                  series: [
                                    {
                                        values: valuesList,
                                        backgroundColor: '#f3950d',
                                        valueBox: [{
                                            placement: "top-out",
                                            color: "#000",
                                            text: "%v%",
                                            fontSize: 14
                                        }]
                                    }
                                  ]
                              }
                            ]
                        }

                        zingchart.render({
                            id: 'myChart',
                            data: chartConfig,
                            height: '500',
                            width: '100%'
                        });
                        var myConfig = {
                            "background-color": "#FFF",
                            "graphset": [

                                {
                                    "type": "pie",
                                    "width": "105%",
                                    "x": "-20%",
                                    "background-color": "#FFF",
                                    "title": {
                                        "background-color": "none",
                                        "font-weight": "normal",
                                        "font-family": "Arial",
                                        "font-color": "#ffffff",
                                        "height": "30px"
                                    },

                                    "plotarea": {
                                        "margin": "20 280 25 30"
                                    },

                                    "plot": {
                                        "animation": {
                                            "delay": 0,
                                            "effect": 2,
                                            "speed": 700,
                                            "method": 6,
                                            "sequence": 1
                                        },
                                        refAngle: 270,

                                    },
                                    "series": [
                                        {
                                            "text": "Moyenne Notes",
                                            "values": [data.note],
                                            "background-color": "#35D884",
                                            "border-color": "#454754",
                                            "border-width": "1px",
                                            "shadow": 0,
                                            "tooltip": {
                                                "background-color": "#35D884",
                                                "font-color": "#000",
                                                "border-radius": "6px",
                                                "shadow": false,
                                                "padding": "5px 10px"
                                            },
                                            valueBox: [{
                                                placement: "in",
                                                color: "#000",
                                                text: "%t: %v %",
                                                fontSize: 14
                                            }]
                                        },

                                              {
                                                  "text": "",
                                                  "values": [
                                                100 - data.note
                                                  ],
                                                  "background-color": "#E8E8E8",
                                                  "border-color": "#454754",
                                                  "border-width": "1px",
                                                  "shadow": 0,
                                                  "tooltip": {
                                                      "background-color": "#E8E8E8",
                                                      "font-color": "#000",
                                                      "border-radius": "6px",
                                                      "shadow": false,
                                                      "padding": "5px 10px"
                                                  },
                                                  valueBox: [{
                                                      placement: "in",
                                                      color: "#E8E8E8",
                                                      text: "%t: %v %",
                                                      fontSize: 0
                                                  }]
                                              }

                                    ]
                                },


                            ]
                        }
                        zingchart.render({
                            id: 'myChartPie',
                            data: myConfig,
                            height: 500,
                            width: 1050
                        });
                        let chartConfig3 = {

                            graphset: [

                                {
                                    type: 'null',
                                    backgroundColor: '#fbfcf7',
                                    borderColor: '#384653',
                                    borderRadius: '4px',
                                    borderWidth: '1px',
                                    width: '15%',
                                    height: '90%',
                                    x: '33.2%',
                                    y: '3%',
                                    title: {
                                        text: 'Nombre des Evaluations',
                                        backgroundColor: 'none',
                                        fontColor: '#384653',
                                        fontSize: '12px',
                                        height: '70px',
                                        textAlign: 'center'
                                    },
                                    subtitle: {
                                        text: NbreEvaluations,
                                        paddingTop: '35%',
                                        bold: true,
                                        fontColor: '#dd655f',
                                        fontSize: '24px',
                                        height: '40px',
                                        textAlign: 'center'
                                    }
                                },
                              {
                                  type: 'null',
                                  backgroundColor: '#fbfcf7',
                                  borderColor: '#384653',
                                  borderRadius: '4px',
                                  borderWidth: '1px',
                                  width: '15%',
                                  height: '90%',
                                  x: '50.8%',
                                  y: '3%',
                                  title: {
                                      text: 'Moyenne des Notes',
                                      backgroundColor: 'none',
                                      fontColor: '#384653',
                                      fontSize: '12px',
                                      height: '70px',
                                      textAlign: 'center'
                                  },
                                  subtitle: {
                                      text: note + '%',
                                      paddingTop: '35%',
                                      bold: true,
                                      fontColor: '#4cc2bb',
                                      fontSize: '24px',
                                      height: '40px',
                                      textAlign: 'center'
                                  }
                              }
                            ]
                        };
                        zingchart.render({
                            id: 'myChart3',
                            data: chartConfig3,
                            height: '120',
                            width: '100%'
                        });

                    },
                    error: function () { },
                });
            })
        })
    </script>

}

@section testProfile{

    <a class="dropdown-toggle" data-toggle="dropdown">
        <img src=@Model.Url alt="">
        <span>@Model.userName</span>
        <i class="caret"></i>
    </a>
    <ul class="dropdown-menu dropdown-menu-right">

        <li><a href="@Url.Action("logout", "Authentification")"><i class="icon-switch2"></i> Logout</a></li>
    </ul>
}
@section sidebarProfile{

    <a href="#" class="media-left"><img src=@Model.Url class="img-circle img-sm" alt=""></a>
    <div class="media-body">
        <span class="media-heading text-semibold">@Model.userName</span>
        <div class="text-size-mini text-muted">
            <i class="icon-user text-size-small"></i> &nbsp;@Model.pseudoNameEmp
        </div>
    </div>
    <div class="media-right media-middle">

    </div>
}
@section pagetitle{
    <h4> <span class="text-semibold">Espace Qualité</span> -  Reportings</h4>
}
@section pagetitlebody{
    <li><a href="#"><i class="icon-home2 position-left"></i> Reportings</a></li>
    <li class="active">Vecteur Plus</li>
    <li class="active">BPP</li>
}
