@model MVCWEB.Models.EvaluationViewModel
@{

    Layout = "~/Views/Shared/_Layout_Qualite.cshtml";
}

@section test{
    <script src="~/Scripts/zingchart.min.js"></script>
    <div class="row">

        <div class="col-1">
            <h6 class="col-xs-2 control-label">Dates Début / Fin </h6>
            <div class="col-xs-3 date">
                <div class="form-group">
                    <div class="input-group">
                        <span class="input-group-addon"><i class="icon-calendar22"></i></span>
                        <input type="text" class="form-control daterange-basic" name="datetimes" id="datetimes" value="01/01/2020 - 01/31/2020">
                    </div>
                </div>
            </div>
        </div>

        <div class="col-1">
            <h6 class="col-xs-2 control-label">Choisissez Collaborateur</h6>
            <div class="col-xs-3">
                @Html.DropDownList("AgentDropdownList", Model.employees, "---Select Collaborateur---", htmlAttributes: new { @class = "bootstrap-select", @id = "agent", @name = "test", style = "data-width: 360px;", selected = "selected" })
                @Html.ValidationMessageFor(model => model.employees, "", new { @class = "text-danger" })
            </div>
        </div>

        <div class="col-xs-1">
            <button id="Save" type="submit" class="btn bg-teal-400" data-title="Chercher" value="Chercher">Recherche <i class="icon-stats-bars3 position-right"></i></button>
        </div>

    </div>

   
<div class="row">
    <div class="col-md-12" id="myChart3"></div>
</div>

<div class="panel border-left-lg border-left-info" style="margin-left: 0.2cm;" id="Details" hidden>
    <div class="panel-body">
        <h6 class="no-margin-top"><a href="task_manager_detailed.html"># Moyenne Items</a></h6>
        <div class="row">
            <div class="col-md-4">

                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Avancement:</label>
                    <div class="col-md-3" id="avancement">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight: bold;">Nature:</label>
                    <div class="col-md-3" id="nature">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Typologie:</label>
                    <div class="col-md-3" id="typologie">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Lieu d'exécution:</label>
                    <div class="col-md-3" id="lieuExecution">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Destination:</label>
                    <div class="col-md-3" id="destination">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Code RP:</label>
                    <div class="col-md-3" id="codeRP">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Nom du Programme:</label>
                    <div class="col-md-3" id="nomProgramme">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Post IT:</label>
                    <div class="col-md-3" id="postIT">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Object:</label>
                    <div class="col-md-3" id="objects">
                    </div>
                </div>
               
            </div>

            <div class="col-md-4">
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Note Clients:</label>
                    <div class="col-md-3" id="notreClients">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">MOA:</label>
                    <div class="col-md-3" id="moa">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">MOA & Architectes:</label>
                    <div class="col-md-3" id="moaArchitectes">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Bureaux d'Etudes:</label>
                    <div class="col-md-3" id="bureauxEtudes">
                    </div>
                </div> 
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Bailleur Sociaux:</label>
                    <div class="col-md-3" id="bailleurSociaux">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Mairie:</label>
                    <div class="col-md-3" id="mairie">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Surface Plancher:</label>
                    <div class="col-md-3" id="surfacePlancher">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Surface Terrain:</label>
                    <div class="col-md-3" id="surfaceTerrain">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Surface par Typologie:</label>
                    <div class="col-md-3" id="surfaceTypologie">
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Nombre de Batiment:</label>
                    <div class="col-md-3" id="nombreBatiment">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Nombre d'étages:</label>
                    <div class="col-md-3" id="nombreEtage">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Ascenceur Oui/Non:</label>
                    <div class="col-md-3" id="ascenseur">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Nombre d'ascenceur:</label>
                    <div class="col-md-3" id="nombreAscenseur">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Date Accord:</label>
                    <div class="col-md-3" id="dateAccords">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Date PC:</label>
                    <div class="col-md-3" id="datePC">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Date de Consultation:</label>
                    <div class="col-md-3" id="dateConsultation">
                    </div>
                </div>

                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Date de Travaux:</label>
                    <div class="col-md-3" id="dateTravaux">
                    </div>
                </div>
                <br />
                <div class="form-group">
                    <label class="col-md-7" style="font-weight:bold;">Date de Livraison:</label>
                    <div class="col-md-3" id="dateLivraison">
                    </div>
                </div>
                <br />
               
            </div>
        </div>

    </div>
</div>


<div class="row" id="Graphs" hidden>
    <div class="col-md-9">
        <div class="panel panel-flat">
            <div class="panel-heading">
                <h6 class="panel-title"><i class="icon-stats-bars3"></i> <span style="font-size: 16px;">Répartition Moyenne des Items Vecteur Plus Battonage</span></h6><hr />
            </div>
            <div class="container-fluid">
                <div>
                    <div id="myChart"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="panel panel-flat">
            <div class="panel-heading">
                <h6 class="panel-title"><i class="icon-pie-chart"></i> <span style="font-size: 16px;">Moyenne des Notes </span></h6><hr />
            </div>
            <div class="container-fluid">
                <div>
                    <div id="myChartPie"></div>
                </div>
            </div>
        </div>
    </div>

</div>

    <script>
        var debut = '01/01/2020';
        var fin = '31/01/2020';
        $(function () {
            $('#datetimes').daterangepicker({

                opens: 'right',
                format: 'DD/MM/YYYY',
                locale: {

                    "daysOfWeek": [
              "Dim",
              "Lun",
              "Mar",
              "Mer",
              "Jeu",
              "Ven",
              "Sam"
                    ],
                    "monthNames": [
                        "Jan",
                        "Fev",
                        "Mar",
                        "Avr",
                        "Mai",
                        "Ju",
                        "Jui",
                        "Aou",
                        "Sep",
                        "Oct",
                        "Nov",
                        "December"
                    ],
                },
                lan: 'fr',


            },
             function (start, end, label) {
                 debut = start.format('DD/MM/YYYY');
                 fin = end.format('DD/MM/YYYY');
             }
            );
        });
    </script>
    <script type="text/javascript">

        $(document).ready(function () {
            $(document).on("click", "#Save", function () {
                $.ajax({
                    url: '/EvaluationVecteurPlus/GetReportsBattonage',
                    type: 'GET',
                    datatype: 'json',
                    data: {
                        username: $("#agent").val(),
                     dateDebut: debut,
                      dateFin: fin
                    },
                    async: true,
                    success: function (data) {
                        //Variables
                        var note = data.note;
                        var NbreEvaluations = data.nbreEvaluations;

                        if (data.nature >= 0) {
                            var nature = data.nature + "%";
                        } else { var nature = "NE" }

                        if (data.typologie >= 0) {
                            var typologie = data.typologie + "%";
                        } else { var typologie = "NE" }

                        if (data.avancement >= 0) {
                            var avancement = data.avancement + "%";
                        } else { var avancement = "NE" }

                        if (data.destination >= 0) {
                            var destination = data.destination + "%";
                        } else { var destination = "NE" }

                        if (data.codeRP >= 0) {
                            var codeRP = data.codeRP + "%";
                        } else { var codeRP = "NE" }

                        if (data.nomProgramme >= 0) {
                            var nomProgramme = data.nomProgramme + "%";
                        } else { var nomProgramme = "NE" }

                        if (data.postIT >= 0) {
                            var postIT = data.postIT + "%";
                        } else { var postIT = "NE" }

                        if (data.objects >= 0) {
                            var objects = data.objects + "%";
                        } else { var objects = "NE" }

                        if (data.notreClients >= 0) {
                            var notreClients = data.notreClients + "%";
                        } else { var notreClients = "NE" }

                        if (data.moa >= 0) {
                            var moa = data.moa + "%";
                        } else { var moa = "NE" }

                        if (data.moaArchitectes >= 0) {
                            var moaArchitectes = data.moaArchitectes + "%";
                        } else { var moaArchitectes = "NE" }

                        if (data.bureauxEtudes >= 0) {
                            var bureauxEtudes = data.bureauxEtudes + "%";
                        } else { var bureauxEtudes = "NE" }

                        if (data.bailleurSociaux >= 0) {
                            var bailleurSociaux = data.bailleurSociaux + "%";
                        } else { var bailleurSociaux = "NE" }

                        if (data.notreClients >= 0) {
                            var notreClients = data.notreClients + "%";
                        } else { var notreClients = "NE" }

                        if (data.mairie >= 0) {
                            var mairie = data.mairie + "%";
                        } else { var mairie = "NE" }

                        if (data.dateAccords >= 0) {
                            var dateAccords = data.dateAccords + "%";
                        } else { var dateAccords = "NE" }

                        if (data.datePC >= 0) {
                            var datePC = data.datePC + "%";
                        } else { var datePC = "NE" }

                        if (data.dateConsultation >= 0) {
                            var dateConsultation = data.dateConsultation + "%";
                        } else { var dateConsultation = "NE" }

                        if (data.dateTravaux >= 0) {
                            var dateTravaux = data.dateTravaux + "%";
                        } else { var dateTravaux = "NE" }

                        if (data.dateLivraison >= 0) {
                            var dateLivraison = data.dateLivraison + "%";
                        } else { var dateLivraison = "NE" }

                        if (data.surfacePlancher >= 0) {
                            var surfacePlancher = data.surfacePlancher + "%";
                        } else { var surfacePlancher = "NE" }

                        if (data.surfaceTerrain >= 0) {
                            var surfaceTerrain = data.surfaceTerrain + "%";
                        } else { var surfaceTerrain = "NE" }

                        if (data.surfaceTypologie >= 0) {
                            var surfaceTypologie = data.surfaceTypologie + "%";
                        } else { var surfaceTypologie = "NE" }

                        if (data.nombreBatiment >= 0) {
                            var nombreBatiment = data.nombreBatiment + "%";
                        } else { var nombreBatiment = "NE" }

                        if (data.nombreEtage >= 0) {
                            var nombreEtage = data.nombreEtage + "%";
                        } else { var nombreEtage = "NE" }

                        if (data.ascenseur >= 0) {
                            var ascenseur = data.ascenseur + "%";
                        } else { var ascenseur = "NE" }

                        if (data.nombreAscenseur >= 0) {
                            var nombreAscenseur = data.nombreAscenseur + "%";
                        } else { var nombreAscenseur = "NE" }

                        if (data.lieuExecution >= 0) {
                            var lieuExecution = data.lieuExecution + "%";
                        } else { var lieuExecution = "NE" }

                        //Affichage
                        $("#Details").show();
                        $("#Graphs").show();

                        $("#nature").html(nature);
                        $("#typologie").html(typologie);
                        $("#avancement").html(avancement);
                        $("#destination").html(destination);
                        $("#codeRP").html(codeRP);
                        $("#nomProgramme").html(nomProgramme);
                        $("#postIT").html(postIT);
                        $("#objects").html(objects);
                        $("#notreClients").html(notreClients);
                        $("#moa").html(moa);
                        $("#moaArchitectes").html(moaArchitectes);
                        $("#bureauxEtudes").html(bureauxEtudes);
                        $("#bailleurSociaux").html(bailleurSociaux);
                        $("#mairie").html(mairie);
                        $("#dateAccords").html(dateAccords);
                        $("#datePC").html(datePC);
                        $("#dateConsultation").html(dateConsultation);
                        $("#dateTravaux").html(dateTravaux);
                        $("#dateLivraison").html(dateLivraison);
                        $("#surfacePlancher").html(surfacePlancher);
                        $("#surfaceTerrain").html(surfaceTerrain);
                        $("#surfaceTypologie").html(surfaceTypologie);
                        $("#nombreBatiment").html(nombreBatiment);
                        $("#nombreEtage").html(nombreEtage);
                        $("#ascenseur").html(ascenseur);
                        $("#nombreAscenseur").html(nombreAscenseur);
                        $("#lieuExecution").html(lieuExecution);

                        var namesList = ["Avancement", "Nature", "Typologie", "Lieu d'exécution", "Destination", "Code RP", "Nom Programme", "Post IT", "Object",
                            "Note Clients", "MOA", "MOA & Architectes", "Bureaux d'Etudes", "Bailleur Sociaux", "Mairie", "Surface Plancher", "Surface Terrain",
                            "Surface par Typologie", "Nombre de Batiment", "Nombre d'étages", "Ascenceur Oui/Non", "Nombre d'ascenceur", "Date Accord", "Date PC",
                            "Date de Consultation", "Date de Travaux", "Date de Livraison"];

                        var values = [data.avancement, data.nature, data.typologie, data.lieuExecution, data.destination, data.codeRP, data.nomProgramme, data.postIT, data.objects,
                            data.notreClients, data.moa, data.moaArchitectes, data.bureauxEtudes, data.bailleurSociaux, data.mairie, data.surfacePlancher, data.surfaceTerrain, data.surfaceTypologie,
                            data.nombreBatiment, data.nombreEtage, data.ascenseur, data.nombreAscenseur,data.dateAccords, data.datePC, data.dateConsultation,
                            data.dateTravaux, data.dateLivraison];

                        var valuesList = [];
                        $.each(values, function (i, t) {
                            if (t >= 0) {
                                valuesList.push(t);
                            }
                            else {
                                valuesList.push(null);
                            }
                        })
                        let chartConfig = {
                            backgroundColor: '#ecf2f6',
                            graphset: [
                              {
                                  type: 'bar',
                                  backgroundColor: '#fff',
                                  borderWidth: '1px',
                                  borderColor: '#dae5ec',
                                  width: '100%',
                                  height: '100%',
                                  x: '0%',
                                  y: '0%',

                                  plot: {
                                      tooltip: {
                                          padding: '5px 10px',
                                          backgroundColor: '#707e94',
                                          borderRadius: '6px',
                                          fontColor: '#fff',
                                          fontFamily: 'Arial',
                                          fontSize: '11px',
                                          shadow: false
                                      },
                                      animation: {
                                          delay: 300,
                                          effect: 'ANIMATION_SLIDE_BOTTOM'
                                      },
                                      barWidth: '28px',
                                      hoverState: {
                                          visible: false
                                      }
                                  },
                                  plotarea: {
                                      margin: '45px 20px 120px 45px'
                                  },
                                  scaleX: {
                                      values: namesList,
                                      guide: {
                                          visible: false
                                      },
                                      item: {
                                          angle: -50,
                                          paddingTop: '2px',
                                          fontColor: '#000',
                                          fontFamily: 'Arial',
                                          fontSize: '11px'
                                      },
                                      itemsOverlap: true,
                                      lineColor: '#d2dae2',
                                      maxItems: 9999,
                                      offsetY: '1px',
                                      tick: {
                                          lineColor: '#d2dae2',
                                          visible: false
                                      }
                                  },
                                  scaleY: {
                                      values: '0:100:50',
                                      guide: {
                                          rules: [
                                                      {
                                                          lineWidth: '0px',
                                                          rule: '%i == 0'
                                                      },
                                                      {
                                                          alpha: 0.4,
                                                          lineColor: '#d2dae2',
                                                          lineStyle: 'solid',
                                                          lineWidth: '1px',
                                                          rule: '%i > 0'
                                                      }
                                          ]
                                      },
                                      item: {
                                          paddingRight: '5px',
                                          fontColor: '#8391a5',
                                          fontFamily: 'Arial',
                                          fontSize: '10px'
                                      },
                                      lineColor: 'none',
                                      maxItems: 4,
                                      maxTicks: 4,
                                      tick: {
                                          visible: false
                                      }
                                  },
                                  series: [
                                    {
                                        values: valuesList,
                                        backgroundColor: '#f3950d',
                                        valueBox: [{
                                            placement: "top-out",
                                            color: "#000",
                                            text: "%v%",
                                            fontSize: 11
                                        }]
                                    }
                                  ]
                              }
                            ]
                        }

                        zingchart.render({
                            id: 'myChart',
                            data: chartConfig,
                            height: '500',
                            width: '100%'
                        });
                        var myConfig = {
                            "background-color": "#FFF",
                            "graphset": [

                                {
                                    "type": "pie",
                                    "width": "105%",
                                    "x": "-7%",
                                    "background-color": "#FFF",
                                    "title": {
                                        "background-color": "none",
                                        "font-weight": "normal",
                                        "font-family": "Arial",
                                        "font-color": "#ffffff",
                                        "height": "30px"
                                    },

                                    "plotarea": {
                                        "margin": "20 280 25 30"
                                    },

                                    "plot": {
                                            "animation": {
                                            "delay": 0,
                                            "effect": 2,
                                            "speed": 700,
                                            "method": 6,
                                            "sequence": 1
                                        },
                                        refAngle: 270,

                                    },
                                    "series": [
                                        {
                                            "text": "Moyenne Notes",
                                            "values": [data.note],
                                            "background-color": "#35D884",
                                            "border-color": "#454754",
                                            "border-width": "1px",
                                            "shadow": 0,
                                            "tooltip": {
                                                "background-color": "#35D884",
                                                "font-color": "#000",
                                                "border-radius": "6px",
                                                "shadow": false,
                                                "padding": "5px 10px"
                                            },
                                            valueBox: [{
                                                placement: "in",
                                                color: "#000",
                                                text: "%t: %v %",
                                                fontSize: 14
                                            }]
                                        },

                                              {
                                                  "text": "",
                                                  "values": [
                                                100 - data.note
                                                  ],
                                                  "background-color": "#E8E8E8",
                                                  "border-color": "#454754",
                                                  "border-width": "1px",
                                                  "shadow": 0,
                                                  "tooltip": {
                                                      "background-color": "#E8E8E8",
                                                      "font-color": "#000",
                                                      "border-radius": "6px",
                                                      "shadow": false,
                                                      "padding": "5px 10px"
                                                  },
                                                  valueBox: [{
                                                      placement: "in",
                                                      color: "#E8E8E8",
                                                      text: "%t: %v %",
                                                      fontSize: 0
                                                  }]
                                              }

                                    ]
                                },


                            ]
                        }
                        zingchart.render({
                            id: 'myChartPie',
                            data: myConfig,
                            height: 500,
                            width: 670
                        });
                        let chartConfig3 = {

                            graphset: [

                                {
                                    type: 'null',
                                    backgroundColor: '#fbfcf7',
                                    borderColor: '#384653',
                                    borderRadius: '4px',
                                    borderWidth: '1px',
                                    width: '15%',
                                    height: '90%',
                                    x: '33.2%',
                                    y: '3%',
                                    title: {
                                        text: 'Nombre des Evaluations',
                                        backgroundColor: 'none',
                                        fontColor: '#384653',
                                        fontSize: '12px',
                                        height: '70px',
                                        textAlign: 'center'
                                    },
                                    subtitle: {
                                        text: NbreEvaluations,
                                        paddingTop: '35%',
                                        bold: true,
                                        fontColor: '#dd655f',
                                        fontSize: '24px',
                                        height: '40px',
                                        textAlign: 'center'
                                    }
                                },
                              {
                                  type: 'null',
                                  backgroundColor: '#fbfcf7',
                                  borderColor: '#384653',
                                  borderRadius: '4px',
                                  borderWidth: '1px',
                                  width: '15%',
                                  height: '90%',
                                  x: '50.8%',
                                  y: '3%',
                                  title: {
                                      text: 'Moyenne des Notes',
                                      backgroundColor: 'none',
                                      fontColor: '#384653',
                                      fontSize: '12px',
                                      height: '70px',
                                      textAlign: 'center'
                                  },
                                  subtitle: {
                                      text: note + '%',
                                      paddingTop: '35%',
                                      bold: true,
                                      fontColor: '#4cc2bb',
                                      fontSize: '24px',
                                      height: '40px',
                                      textAlign: 'center'
                                  }
                              }
                            ]
                        };
                        zingchart.render({
                            id: 'myChart3',
                            data: chartConfig3,
                            height: '120',
                            width: '100%'
                        });

                    },
                    error: function () { },
                });
            })
        })
    </script>

}

@section testProfile{

    <a class="dropdown-toggle" data-toggle="dropdown">
        <img src=@Model.Url alt="">
        <span>@Model.userName</span>
        <i class="caret"></i>
    </a>
    <ul class="dropdown-menu dropdown-menu-right">

        <li><a href="@Url.Action("logout", "Authentification")"><i class="icon-switch2"></i> Logout</a></li>
    </ul>
}
@section sidebarProfile{

    <a href="#" class="media-left"><img src=@Model.Url class="img-circle img-sm" alt=""></a>
    <div class="media-body">
        <span class="media-heading text-semibold">@Model.userName</span>
        <div class="text-size-mini text-muted">
            <i class="icon-user text-size-small"></i> &nbsp;@Model.pseudoNameEmp
        </div>
    </div>
    <div class="media-right media-middle">

    </div>
}
@section pagetitle{
    <h4> <span class="text-semibold">Espace Qualité</span> -  Reportings</h4>
}
@section pagetitlebody{
    <li><a href="#"><i class="icon-home2 position-left"></i> Reportings</a></li>
    <li class="active">Vecteur Plus</li>
    <li class="active">Battonage</li>
}
