@model MVCWEB.Models.DirectoryViewModel

@if (ViewBag.role == "Qualité")
{
    ViewBag.Title = "IndexMultipleAgent";

    Layout = "~/Views/Shared/_Layout_Qualite.cshtml";
}
@if (ViewBag.role == "Agent Qualité")
{
    ViewBag.Title = "IndexMultipleAgent";

    Layout = "~/Views/Shared/_Layout_AgentQualite.cshtml";
}
@if (ViewBag.role == "Agent Qualité_CustomerService")
{
    ViewBag.Title = "IndexMultipleAgent";

    Layout = "~/Views/Shared/_Layout_CustomerService.cshtml";
}
@if (ViewBag.role == "Agent Qualité_HL")
{
    ViewBag.Title = "IndexMultipleAgent";

    Layout = "~/Views/Shared/_Layout_Qualite_HL.cshtml";
}
@if (ViewBag.role == "Agent Qualité_Diffusion")
{
    ViewBag.Title = "IndexMultipleAgent";

    Layout = "~/Views/Shared/_Layout_Diffusion.cshtml";
}
@if (ViewBag.role == "Agent Qualité_AchatPublic")
{
    Layout = "~/Views/Shared/_Layout_AchatPublic.cshtml";
}
@if (ViewBag.role == "Agent Qualité_PRV")
{
    Layout = "~/Views/Shared/_Layout_PRV.cshtml";
}
@section test{
    <script type="text/javascript" src="/Content/template/Layout 1/LTR/assets/js/plugins/pickers/daterangepicker.js"></script>


    <div class="form-group">
        <div class="row">
            <div class="col-1">
                <div class="col-xs-6">
                    <span>liste des Agents: </span>
                </div>
               
                <div class="col-xs-6">
                    <span>Enregistrements entre deux dates: </span>
                </div>
              
            </div>
        </div>
        <div class="row">


            <div class="col-1">
                <div class="col-xs-6">

                    <div class="form-group">
                        <div class="multi-select-full">
                            @Html.DropDownList("PseudoName", Model.utilisateursPseudonames, htmlAttributes: new { @class = "multiselect-filtering", @id = "PseudoName", @name = "PseudoName", style = "data-width: 360px;", selected = "selected", multiple = "multiple" })
                            @Html.ValidationMessageFor(model => model.utilisateursPseudonames, "", new { @class = "text-danger" })

                        </div>
                    </div>
                </div>             

                <div class="col-xs-6">

                    <div class="form-group">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="icon-calendar22"></i></span>
                            <input type="text" class="form-control daterange-basic" name="datetimes" id="datetimes" value="01/01/2020 - 01/31/2020">
                        </div>
                    </div>
                </div>
                
               </div>

            <br />
            <br />
            <br />

            <div class="col-12">
                @if (Model.roleKey == "V4")
                {
                    @*<button id="imedSave" type="submit" class="btn bg-teal-400 btn-block" data-title="Chercher Enregistrement" value="Chercher Enregistrement" data-toggle="modal">Recherche <i class="icon-arrow-right14 position-fixed"></i></button>*@
                    <center>
                        <button id="imedSave" type="submit" class="btn bg-teal-400 btn-float btn-float-lg" data-title="Chercher Enregistrement" value="Chercher Enregistrement" data-toggle="modal"><i class="icon-users4"></i> <span>Chercher</span></button>
                    </center>
                }
                else
                {
                    @*<button id="imedSaveV5" type="submit" class="btn bg-teal-400 btn-block" data-title="Chercher Enregistrement" value="Chercher Enregistrement" data-toggle="modal">Recherche <i class="icon-arrow-right14 position-fixed"></i></button>*@
                    <center>
                        <button id="imedSaveV5" type="submit" class="btn bg-teal-400 btn-float btn-float-lg" data-title="Chercher Enregistrement" value="Chercher Enregistrement" data-toggle="modal"><i class="icon-users4"></i> <span>Chercher</span></button>
                    </center>
                }
            </div>
            <div>
                <font color="red">@ViewBag.message</font>
            </div>
        </div>
    </div>



    @{ 

        String test = TempData["nbEnr"] as String;
        }

    <br />
<div class="panel panel-body border-top-danger text-center" id="loadimage" style="display:none;">
    @*<h6 class="no-margin text-semibold">Recherche des Enregistrements En cours @Model.DirecoryModel.nbresEnrefgistrements @test</h6>*@
    <h6 class="no-margin text-semibold">Recherche des Enregistrements En cours</h6>
    <p class="content-group-sm text-muted">Option:  <code>Sélection plusieurs Agents</code></p>
    <div class="pace-demo">
        <div class="theme_xbox_xs">
            <div class="pace_progress" data-progress-text="" data-progress="">
            </div>
            <div class="pace_activity">
            </div>
        </div>
    </div>
    <div class="pace-demo" style="padding-top: 10px; padding-bottom: 30px;">
        <div class="theme_xbox_xs theme_xbox_with_text">
            <div class="pace_progress" data-progress-text="" data-progress="60">
            </div>
            <div class="pace_activity">
            </div>
        </div>
    </div>
</div>
    <div id="explore1">
    </div>
    <div class="row">
        <div class="col-lg-3 col-sm-6">
        </div>
        <div id="progress" class="progress" style="display:none;">
            <div class="progress-bar progress-bar-striped active" role="progressbar"
                 aria-valuenow="@ViewBag.pourcentage" aria-valuemin="0" aria-valuemax="100" style="width: @ViewBag.pourcentage%">
                @ViewBag.pourcentage % Complete (success)
            </div>
        </div>
        <div class="col-lg-3 col-sm-6">
            <img id="loadimage2" src="~/Content/Loading-GIF-Image-3.gif" style="display: none; align-content:center" />

        </div>
        <div class="col-lg-3 col-sm-6">

        </div>
        <div>
            @Html.ValidationSummary(true, "", new { @class = "text-danger" })
            @Html.HiddenFor(model => model.roleName, new { @Id = "roleName" })
            @Html.HiddenFor(model => model.roleKey, new { @Id = "roleKey" })
        </div>
    </div>

    <script>
        $('#datePicker')
               .daterangepicker({
                   singleDatePicker: true,
                   locale: {
                       setDate: new Date(),
                       format: 'DD/MM/YYYY',
                       "daysOfWeek": [
            "Dim",
            "Lun",
            "Mar",
            "Mer",
            "Jeu",
            "Ven",
            "Sam"
                       ],
                       "monthNames": [
                           "Jan",
                           "Fev",
                           "Mar",
                           "Avr",
                           "Mai",
                           "Ju",
                           "Jui",
                           "Aou",
                           "Sep",
                           "Oct",
                           "Nov",
                           "December"
                       ],
                   },
                   lan: 'fr',
                   autoclose: true,
               })
               .on('changeDate', function (e) {
                   $('#datepicker').hide();
               });

    </script>
    <script>
    var debut;
    var fin;
$(function() {
    $('#datetimes').daterangepicker({

        opens: 'left',
        format: 'DD/MM/YYYY',
        locale: {

            "daysOfWeek": [
      "Dim",
      "Lun",
      "Mar",
      "Mer",
      "Jeu",
      "Ven",
      "Sam"
            ],
            "monthNames": [
                "Jan",
                "Fev",
                "Mar",
                "Avr",
                "Mai",
                "Ju",
                "Jui",
                "Aou",
                "Sep",
                "Oct",
                "Nov",
                "December"
            ],
        },
        lan: 'fr',


    },
     function (start, end, label) {
         debut = start.format('DD/MM/YYYY');
         fin = end.format('DD/MM/YYYY');
     }
    );
});
    </script>
    <script type="text/javascript">

        $(document).ready(function () {
            $(document).on("click", "#imedSave", function () {

                //alert(fin);
                $('#explore1').hide();

                $('#loadimage').show();
                var tests = new Array();
               
                $('#PseudoName option:selected').each(function () {
                    
                    tests.push(new Array($(this).val()));


                });
                $.ajax({
                    url: '/Superviseur/FindDMultipleAgent',
                    type: 'GET',
                    contentType: "application/json; charset=utf-8",
                    traditional: true,
                    
                    data: {
                        
                        pseudoNames: tests,
                        roleName:$("#roleName").val(),
                        start: debut,
                        end: fin
                    },
                    datatype: "html",
                    async: true,
                    success: function (data) {
                        $('#explore1').html(data);
                        $('#errorFile').modal('show');
                        $('#errorFile2').modal('show');
                        $('#errordate').modal('show');

                        //alert("utilisateur"+" "+$("#typeGenerator").val()+" "+""+ $("#datePicker").val())
                    },
                    complete: function () {
                        $('#loadimage').hide();
                        $('#explore1').show();

                    }
                });
            })
            $(document).on("click", "#imedSaveV5", function () {
                $('#explore1').hide();
                $('#loadimage').show();
                var tests = new Array();
                $('#PseudoName option:selected').each(function () {
                    tests.push(new Array($(this).val()));
                });
                $.ajax({
                    url: '/Superviseur/FindDMultipleAgentV5',
                    type: 'GET',
                    contentType: "application/json; charset=utf-8",
                    traditional: true,

                    data: {

                        pseudoNames: tests,
                        roleName: $("#roleName").val(),
                        roleKey: $("#roleKey").val(),
                        start: debut,
                        end: fin
                    },
                    datatype: "html",
                    async: true,
                    success: function (data) {
                        $('#explore1').html(data);
                        $('#errorFile').modal('show');
                        $('#errorFile2').modal('show');
                        $('#errordate').modal('show');
                    },
                    complete: function () {
                        $('#loadimage').hide();
                        $('#explore1').show();

                    }
                });
            })
        })
    </script>
    <script>
    $(document).ready(function () {
        $(document).on("click", "#stopRecherche", function () {

                //alert(fin);

            $('#explore1').show();

            $('#loadimage').hide();
                $.ajax({
                    url: '/Superviseur/AnnulerRecherche',
                    type: 'GET',
                    datatype: 'json',
                    data: {

                    },
                    async: true,
                    //success: function (data) {
                    //    $('#explore1').html(data);
                    //    $('#errorFile').modal('show');
                    //    $('#errorFile2').modal('show');
                    //    $('#errordate').modal('show');

                    //    //alert("utilisateur"+" "+$("#typeGenerator").val()+" "+""+ $("#datePicker").val())
                    //},
                    //complete: function () {
                    //    $('#loadimage').hide();
                    //    $('#explore1').show();

                    //}
                });
            })
        })
    </script>
}
@*@section testProfile{

    <a class="dropdown-toggle" data-toggle="dropdown">
        <img src=@Model.Url alt="">
        <span>@Model.userName</span>
        <i class="caret"></i>
    </a>
    <ul class="dropdown-menu dropdown-menu-right">

        <li><a href="@Url.Action("logout", "Authentification")"><i class="icon-switch2"></i> Logout</a></li>
    </ul>
}
@section sidebarProfile{

    <a href="#" class="media-left"><img src=@Model.Url class="img-circle img-sm" alt=""></a>
    <div class="media-body">
        <span class="media-heading text-semibold">@Model.userName</span>
        <div class="text-size-mini text-muted">
            <i class="icon-user text-size-small"></i> &nbsp;@Model.pseudoNameEmp
        </div>
    </div>
    <div class="media-right media-middle">

    </div>
}*@
@section pagetitle{
<h4> <span class="text-semibold">Accès aux Enregistrements</span> @Model.roleName  </h4>
}
@section pagetitlebody{
    <li><a href="#"><i class="icon-home2 position-left"></i> Accès aux Enregistrements</a></li>
    <li class="active">Multiple Agents</li>
}
@section testProfile{

    <a class="dropdown-toggle" data-toggle="dropdown">
        <img src=@Model.Url alt="">
        <span>@Model.userName</span>
        <i class="caret"></i>
    </a>
    <ul class="dropdown-menu dropdown-menu-right">

        <li><a href="@Url.Action("logout", "Authentification")"><i class="icon-switch2"></i> Logout</a></li>
    </ul>
}
@section sidebarProfile{

    <a href="#" class="media-left"><img src=@Model.Url class="img-circle img-sm" alt=""></a>
    <div class="media-body">
        <span class="media-heading text-semibold">@Model.userName</span>
        <div class="text-size-mini text-muted">
            <i class="icon-user text-size-small"></i> &nbsp;@Model.pseudoNameEmp
        </div>
    </div>
    <div class="media-right media-middle">

    </div>
}