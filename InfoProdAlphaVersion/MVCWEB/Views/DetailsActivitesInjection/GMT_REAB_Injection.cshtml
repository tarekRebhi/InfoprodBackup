@model MVCWEB.Models.EmployeeViewModel

@{
    ViewBag.Title = "GMT_REAB_Injection";
    Layout = "~/Views/Shared/_Layout_user.cshtml";
}
@section extract {
    <li> <a onclick="tablesToExcel(['Grid2'], ['GMT_REAB Par Titre et Date Injection'], 'SuiviInjection_ParTraitementCampagne.xls', 'Excel')"> <span class="glyphicon glyphicon-export"></span>Télécharger Excel</a></li>
}
@section test{
    <script type="text/javascript" src="~/Scripts/datepicker.min.js"></script>

    <div id="toPDF">
        <!-- GMT REAB Qualif Par Titre  -->
        <div class="panel panel-flat">
            <div class="panel-heading">
                <h5 class="panel-title">Détails Qualifications GMT REAB Par Titre et Par Date d'Injection</h5>
                <div class="heading-elements">
                    <ul class="icons-list">
                        <li><a data-action="collapse"></a></li>
                        <li><a data-action="reload"></a></li>
                        <li><a data-action="close"></a></li>
                    </ul>
                </div>
            </div>
            <form>
                @foreach (var temp in ViewBag.AllTitres)
    {
                    <div class="row-md-12">
                        <div class="col-md-2">
                            <label class="radio-inline">
                                <input id="SelectedTitre" type="radio" name="SelectedTitre" checked="checked" value="@temp">
                                @temp
                            </label>
                        </div>
                    </div>
                }
            </form>
            <br /><br /><br /><br /><br />
            <div class="panel-body">
                <form id="eventForm">
                    <div class="row">
                        <div class="col-1">
                            <h6 class="col-xs-2 control-label">Choisir Date d'injection</h6>
                            <div class="col-xs-3">
                                @Html.DropDownList("DateInjDropDown", new SelectList(string.Empty, "Value", "Text"), new { style = "height: 35px;", @class = "form-control", onchange = "getSelectedTitreCalcul()" })

                            </div>
                        </div>

                        <div class="col-1">
                            <h6 class="col-xs-1 control-label"> Choisir Rang</h6>
                            <div class="col-xs-2">
                                <select class="form-control" id="RangDropDown" onchange="getSelectedTitreCalcul()">
                                    <option value="">Tout</option>
                                    <option value="REATELR1">REATELR1</option>
                                    <option value="REATELR9">REATELR9</option>
                                    <option value="REATELEC">REATELEC</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <div class="row-md-12">
                <ul class="list-inline text-center" style="font-size: 14px;">
                    <li>
                        <a href="#" class="btn border-primary text-primary btn-flat btn-rounded btn-icon btn-xs valign-text-bottom"><i class="icon-statistics"></i></a>
                    </li>
                    <li class="text-left">
                        <div class="text-semibold">Fiches Injectées</div>
                        <div id="finj"></div>
                    </li>

                    <li>
                        <a href="#" class="btn border-teal text-teal btn-flat btn-rounded btn-icon btn-xs valign-text-bottom"><i class="icon-statistics"></i></a>
                    </li>
                    <li class="text-left">
                        <div class="text-semibold">Fiches Traitées</div>
                        <div id="ft2"></div>
                    </li>

                    <li>
                        <a href="#" class="btn border-warning-400 text-warning-400 btn-flat btn-rounded btn-icon btn-xs valign-text-bottom"><i class="icon-statistics"></i></a>
                    </li>
                    <li class="text-left">
                        <div class="text-semibold">Fiches Cloturées</div>
                        <div id="fc2"></div>
                    </li>

                    <li>
                        <a href="#" class="btn border-indigo-400 text-indigo-400 btn-flat btn-rounded btn-icon btn-xs valign-text-bottom"><i class="icon-statistics"></i></a>
                    </li>
                    <li class="text-left">
                        <div class="text-semibold">Contacts Argumentés</div>
                        <div id="arg2"></div>
                    </li>

                    <li>
                        <a href="#" class="btn border-danger-400 text-danger-400 btn-flat btn-rounded btn-icon btn-xs valign-text-bottom"><i class="icon-statistics"></i></a>
                    </li>
                    <li class="text-left">
                        <div class="text-semibold">Taux d'Exploitation</div>
                        <div id="exploi2"></div>
                    </li>

                    <li>
                        <a href="#" class="btn border-success-400 text-success-400 btn-flat btn-rounded btn-icon btn-xs valign-text-bottom"><i class="icon-statistics"></i></a>
                    </li>
                    <li class="text-left">
                        <div class="text-semibold">Taux d'Accord</div>
                        <div id="acc2"></div>
                    </li>
                </ul>
            </div>

            <br /><br />
            <div class="row">
                <div class="col-lg-12">
                    <div>
                        <table class="table" style="font-size: 14px;">
                            <thead>
                                <tr class="bg-grey">
                                    <th style="width:100px; text-align: center;">Type</th>
                                    <th style="width: 400px; text-align: center;">Détails Qualifications</th>
                                    <th style="width: 200px;text-align: center;">Nombre</th>
                                    <th style="width: 200px;text-align: center;">Pourcentage</th>
                                </tr>
                            </thead>

                        </table>
                    </div>
                    <div @*style="height: 480px;overflow: auto"*@>
                        <table class="table" id="Grid2" style="font-size: 12px;">

                            <tbody style="text-align: center;"></tbody>
                        </table>
                        <br />
                    </div>
                </div>
            </div>
        </div>
        <!-- /fin row -->
    </div>


    <!-- /GMT REAB Qualif Par Titre -->
    <script>

        var tablesToExcel = (function () {
            var uri = 'data:application/vnd.ms-excel;base64,'
            , tmplWorkbookXML = '<?xml version="1.0"?><?mso-application progid="Excel.Sheet"?><Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet" xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet">'
              + '<DocumentProperties xmlns="urn:schemas-microsoft-com:office:office"><Author>Axel Richter</Author><Created>{created}</Created></DocumentProperties>'
              + '<Styles>'
              + '<Style ss:ID="Currency"><NumberFormat ss:Format="Currency"></NumberFormat></Style>'
              + '<Style ss:ID="Date"><NumberFormat ss:Format="Medium Date"></NumberFormat></Style>'
              + '</Styles>'
              + '{worksheets}</Workbook>'
            , tmplWorksheetXML = '<Worksheet ss:Name="{nameWS}"><Table>{rows}</Table></Worksheet>'
            , tmplCellXML = '<Cell{attributeStyleID}{attributeFormula}><Data ss:Type="{nameType}">{data}</Data></Cell>'
            , base64 = function (s) { return window.btoa(unescape(encodeURIComponent(s))) }
            , format = function (s, c) { return s.replace(/{(\w+)}/g, function (m, p) { return c[p]; }) }
            return function (tables, wsnames, wbname, appname) {
                var ctx = "";
                var workbookXML = "";
                var worksheetsXML = "";
                var rowsXML = "";

                for (var i = 0; i < tables.length; i++) {
                    if (!tables[i].nodeType) tables[i] = document.getElementById(tables[i]);
                    for (var j = 0; j < tables[i].rows.length; j++) {
                        rowsXML += '<Row>'
                        for (var k = 0; k < tables[i].rows[j].cells.length; k++) {
                            var dataType = tables[i].rows[j].cells[k].getAttribute("data-type");
                            var dataStyle = tables[i].rows[j].cells[k].getAttribute("data-style");
                            var dataValue = tables[i].rows[j].cells[k].getAttribute("data-value");
                            dataValue = (dataValue) ? dataValue : tables[i].rows[j].cells[k].innerHTML;
                            var dataFormula = tables[i].rows[j].cells[k].getAttribute("data-formula");
                            dataFormula = (dataFormula) ? dataFormula : (appname == 'Calc' && dataType == 'DateTime') ? dataValue : null;
                            ctx = {
                                attributeStyleID: (dataStyle == 'Currency' || dataStyle == 'Date') ? ' ss:StyleID="' + dataStyle + '"' : ''
                                   , nameType: (dataType == 'Number' || dataType == 'DateTime' || dataType == 'Boolean' || dataType == 'Error') ? dataType : 'String'
                                   , data: (dataFormula) ? '' : dataValue
                                   , attributeFormula: (dataFormula) ? ' ss:Formula="' + dataFormula + '"' : ''
                            };
                            rowsXML += format(tmplCellXML, ctx);
                        }
                        rowsXML += '</Row>'
                    }
                    ctx = { rows: rowsXML, nameWS: wsnames[i] || 'Sheet' + i };
                    worksheetsXML += format(tmplWorksheetXML, ctx);
                    rowsXML = "";
                }

                ctx = { created: (new Date()).getTime(), worksheets: worksheetsXML };
                workbookXML = format(tmplWorkbookXML, ctx);

                console.log(workbookXML);

                var link = document.createElement("A");
                link.href = uri + base64(workbookXML);
                link.download = wbname || 'Workbook.xls';
                link.target = '_blank';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        })();
    </script>
    <script type="text/javascript">
    $(document).ready(function () {
        $("#DateInjDropDown").empty();
        $.ajax({
            type: 'POST',
            url: '@Url.Action("GetDatesInjGMTREAB")',
            dataType: 'json',
            data: {
                SelectedTitre: $("#SelectedTitre:checked").val()
            },
            success: function (DatesInjectionItems) {

                $.each(DatesInjectionItems, function (i, t) {
                    $("#DateInjDropDown").append('<option value="' + t.Value + '">' +
                     t.Text + '</option>');
                });
            },
            error: function (ex) {
                alert('Failed to retrieve states.' + ex);
            }
        });
        return false;
    })

    $('input[type=radio][name=SelectedTitre]').change(function () {
        $("#DateInjDropDown").empty();
            $.ajax({
            type: 'POST',
            url: '@Url.Action("GetDatesInjGMTREAB")',
            dataType: 'json',
            data: {
                SelectedTitre: $("#SelectedTitre:checked").val()
            },
            success: function (DatesInjectionItems) {
                $.each(DatesInjectionItems, function (i, t) {
                    $("#DateInjDropDown").append('<option value="' + t.Value + '">' +
                     t.Text + '</option>');
                });
            },
            error: function (ex) {
                alert('Failed to retrieve states.' + ex);
            }
        });
        return false;
    })
    </script>
    <script>
        $(document).ready(function () {
            $.ajax({
                url: '@Url.Action("GetReabGmtValuesParTitre")',
                type: 'POST',
                datatype: 'json',
                data: {
                    SelectedTitre: $("#SelectedTitre:checked").val(),
                    DateInj: $("#DateInjDropDown").val(),
                    rang: $("#RangDropDown").val()

                },

                success: function (c) {

                    var tblHtml = "";
                    var traites = "";
                    var clotures = "";
                    var injectes = "";
                    var ca = "";
                    var tauxexploitation = "";
                    var tauxaccord = "";
                    $.each(c, function (index, cal) {
                        if (index >= 0 && index < 32) {
                            if (cal.type == "CA Positif") {
                                tblHtml += "<tr><td style='width:100px;'><span style='width:100px;' class='label label-success'>" + cal.type + "</span></td>";
                            }
                            if (cal.type == "CA Négatif") {
                                tblHtml += "<tr><td style='width:100px;'><span style='width:100px;' class='label label-danger'>" + cal.type + "</span></td>";
                            }
                            if (cal.type == "Autre") {
                                tblHtml += "<tr><td style='width:100px;'><span style='width:100px;' class='label label-primary'>" + cal.type + "</span></td>";
                            }
                            tblHtml += "<td style='width:400px;'>" + cal.nom + "</td>";
                            tblHtml += "<td style='width:200px;'>" + cal.nombre + "</td>";
                            tblHtml += "<td style='width:200px;'>" + cal.pourcentage + "%" + "</td></tr>";
                        }
                        if (index == 32) {
                            traites += cal.nombre;
                        }
                        if (index == 33) {
                            clotures += cal.nombre;
                            tauxexploitation += cal.pourcentage + "%";
                        }
                        if (index == 34) {
                            ca += cal.nombre;
                            tauxaccord += cal.pourcentage + "%";
                        }
                        if (index == 35) {
                            injectes += cal.nombre;
                        }
                    });

                    $("#Grid2 > tbody").html(tblHtml);
                    $("#ft2").html(traites);
                    $("#fc2").html(clotures);
                    $("#arg2").html(ca);
                    $("#exploi2").html(tauxexploitation);
                    $("#acc2").html(tauxaccord);
                    $("#finj").html(injectes);
                },
                error: function () { },
            });
        })
    function getSelectedTitreCalcul() {
        $.ajax({
            url: '@Url.Action("GetReabGmtValuesParTitre")',
            type: 'POST',
            datatype: 'json',
            data: {
                SelectedTitre: $("#SelectedTitre:checked").val(),
                DateInj: $("#DateInjDropDown").val(),
                rang: $("#RangDropDown").val()
            },

            success: function (c) {

                var tblHtml = "";
                var traites = "";
                var clotures = "";
                var ca = "";
                var tauxexploitation = "";
                var tauxaccord = "";
                var injectes = "";
                $.each(c, function (index, cal) {
                    if (index >= 0 && index < 32) {
                        if (cal.type == "CA Positif") {
                            tblHtml += "<tr><td style='width:100px;'><span style='width:100px;' class='label label-success'>" + cal.type + "</span></td>";
                        }
                        if (cal.type == "CA Négatif") {
                            tblHtml += "<tr><td style='width:100px;'><span style='width:100px;' class='label label-danger'>" + cal.type + "</span></td>";
                        }
                        if (cal.type == "Autre") {
                            tblHtml += "<tr><td style='width:100px;'><span style='width:100px;' class='label label-primary'>" + cal.type + "</span></td>";
                        }
                        tblHtml += "<td style='width:400px;'>" + cal.nom + "</td>";
                        tblHtml += "<td style='width:200px;'>" + cal.nombre + "</td>";
                        tblHtml += "<td style='width:200px;'>" + cal.pourcentage + "%" + "</td></tr>";
                    }
                    if (index == 32) {
                        traites += cal.nombre;
                    }
                    if (index == 33) {
                        clotures += cal.nombre;
                        tauxexploitation += cal.pourcentage + "%";
                    }
                    if (index == 34) {
                        ca += cal.nombre;
                        tauxaccord += cal.pourcentage + "%";
                    }
                    if (index == 35) {
                        injectes += cal.nombre;
                    }

                });

                $("#Grid2 > tbody").html(tblHtml);
                $("#ft2").html(traites);
                $("#fc2").html(clotures);
                $("#arg2").html(ca);
                $("#exploi2").html(tauxexploitation);
                $("#acc2").html(tauxaccord);
                $("#finj").html(injectes);
            },
            error: function () { },
        });
    }
    $('input[type=radio][name=SelectedTitre]').change(function () {
        $.ajax({
            url: '@Url.Action("GetReabGmtValuesParTitre")',
            type: 'POST',
            datatype: 'json',
            data: {
                SelectedTitre: $("#SelectedTitre:checked").val(),
                DateInj: $("#DateInjDropDown").val(),
                rang: $("#RangDropDown").val()
            },

            success: function (c) {

                var tblHtml = "";
                var traites = "";
                var clotures = "";
                var ca = "";
                var tauxexploitation = "";
                var tauxaccord = "";
                var injectes = "";
                $.each(c, function (index, cal) {
                    if (index >= 0 && index < 32) {
                        if (cal.type == "CA Positif") {
                            tblHtml += "<tr><td style='width:100px;'><span style='width:100px;' class='label label-success'>" + cal.type + "</span></td>";
                        }
                        if (cal.type == "CA Négatif") {
                            tblHtml += "<tr><td style='width:100px;'><span style='width:100px;' class='label label-danger'>" + cal.type + "</span></td>";
                        }
                        if (cal.type == "Autre") {
                            tblHtml += "<tr><td style='width:100px;'><span style='width:100px;' class='label label-primary'>" + cal.type + "</span></td>";
                        }
                        tblHtml += "<td style='width:400px;'>" + cal.nom + "</td>";
                        tblHtml += "<td style='width:200px;'>" + cal.nombre + "</td>";
                        tblHtml += "<td style='width:200px;'>" + cal.pourcentage + "%" + "</td></tr>";
                    }
                    if (index == 32) {
                        traites += cal.nombre;
                    }
                    if (index == 33) {
                        clotures += cal.nombre;
                        tauxexploitation += cal.pourcentage + "%";
                    }
                    if (index == 34) {
                        ca += cal.nombre;
                        tauxaccord += cal.pourcentage + "%";
                    }
                    if (index == 35) {
                        injectes += cal.nombre;
                    }
                });

                $("#Grid2 > tbody").html(tblHtml);
                $("#ft2").html(traites);
                $("#fc2").html(clotures);
                $("#arg2").html(ca);
                $("#exploi2").html(tauxexploitation);
                $("#acc2").html(tauxaccord);
                $("#finj").html(injectes);
            },
            error: function () { },
        });
    })

    </script>

    <script type="text/javascript" src="~/Scripts/moment.min.js"></script>
    <script type="text/javascript" src="~/Scripts/picker_date.js"></script>
    <script type="text/javascript" src="~/Scripts/daterangepicker.js"></script>
}
@section testProfile{
    <a class="dropdown-toggle" data-toggle="dropdown">
        <img src=@Model.Url alt="">
        <span>@Model.userName</span>
        <i class="caret"></i>
    </a>
    <ul class="dropdown-menu dropdown-menu-right">

        <li><a href="@Url.Action("logout", "Authentification")"><i class="icon-switch2"></i> Logout</a></li>
    </ul>
}
@section sidebarProfile{

    <a href="#" class="media-left"><img src=@Model.Url class="img-circle img-sm" alt=""></a>
    <div class="media-body">
        <span class="media-heading text-semibold">@Model.userName</span>
        <div class="text-size-mini text-muted">
            <i class="icon-user text-size-small"></i> &nbsp;@Model.pseudoName
        </div>
    </div>
    <div class="media-right media-middle">
    </div>

}
@section pagetitle{
    <h4> <span class="text-semibold">Espace Manager</span> -  Suivi Par Injections</h4>
}
@section pagetitlebody{
    <li><a href="#"><i class="icon-home2 position-left"></i> Suivi Par Injections</a></li>
    <li>Par Traitement de Campagne</li>
    <li class="active">GMT-REAB</li>
}